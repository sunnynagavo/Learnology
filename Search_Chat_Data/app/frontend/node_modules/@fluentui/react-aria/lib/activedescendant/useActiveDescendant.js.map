{"version":3,"sources":["useActiveDescendant.ts"],"sourcesContent":["import * as React from 'react';\nimport { useOptionWalker } from './useOptionWalker';\nimport type { ActiveDescendantOptions } from './types';\nimport { ACTIVEDESCENDANT_ATTRIBUTE } from './constants';\n\nexport function useActiveDescendant<TActiveParentElement extends HTMLElement, TListboxElement extends HTMLElement>(\n  options: ActiveDescendantOptions,\n) {\n  const { imperativeRef, matchOption } = options;\n  const activeParentRef = React.useRef<TActiveParentElement>(null);\n  const { listboxRef, optionWalker } = useOptionWalker<TListboxElement>({ matchOption });\n  const getActiveDescendant = () => {\n    return listboxRef.current?.querySelector<HTMLElement>(`[${ACTIVEDESCENDANT_ATTRIBUTE}]`);\n  };\n\n  const setActiveDescendant = (nextActive: HTMLElement | undefined) => {\n    const active = getActiveDescendant();\n    if (active) {\n      active.removeAttribute(ACTIVEDESCENDANT_ATTRIBUTE);\n    }\n\n    if (nextActive) {\n      nextActive.setAttribute(ACTIVEDESCENDANT_ATTRIBUTE, '');\n      activeParentRef.current?.setAttribute('aria-activedescendant', nextActive.id);\n    } else {\n      activeParentRef.current?.removeAttribute('aria-activedescendant');\n    }\n  };\n\n  React.useImperativeHandle(imperativeRef, () => ({\n    first: () => {\n      if (!listboxRef.current || !activeParentRef.current) {\n        return;\n      }\n\n      const first = optionWalker.first();\n      if (first) {\n        setActiveDescendant(first);\n      }\n    },\n    next: () => {\n      if (!listboxRef.current || !activeParentRef.current) {\n        return;\n      }\n\n      const active = getActiveDescendant();\n      if (!active) {\n        return;\n      }\n\n      optionWalker.setCurrent(active);\n      const next = optionWalker.next();\n      if (next) {\n        setActiveDescendant(next);\n      }\n    },\n    prev: () => {\n      if (!listboxRef.current || !activeParentRef.current) {\n        return;\n      }\n\n      const active = getActiveDescendant();\n      if (!active) {\n        return;\n      }\n\n      optionWalker.setCurrent(active);\n      const next = optionWalker.prev();\n\n      if (next && next !== listboxRef.current) {\n        setActiveDescendant(next);\n      }\n    },\n    blur: () => {\n      if (!listboxRef.current || !activeParentRef.current) {\n        return;\n      }\n\n      setActiveDescendant(undefined);\n    },\n    active: () => {\n      if (listboxRef.current) {\n        return getActiveDescendant()?.id;\n      }\n    },\n\n    focus: (id: string) => {\n      if (!listboxRef.current) {\n        return;\n      }\n\n      optionWalker.setCurrent(listboxRef.current);\n      let cur = optionWalker.next();\n\n      while (cur && cur.id !== id) {\n        cur = optionWalker.next();\n      }\n\n      if (cur) {\n        setActiveDescendant(cur);\n      }\n    },\n  }));\n\n  return { listboxRef, activeParentRef };\n}\n"],"names":["React","useOptionWalker","ACTIVEDESCENDANT_ATTRIBUTE","useActiveDescendant","options","imperativeRef","matchOption","activeParentRef","useRef","listboxRef","optionWalker","getActiveDescendant","current","querySelector","setActiveDescendant","nextActive","active","removeAttribute","setAttribute","id","useImperativeHandle","first","next","setCurrent","prev","blur","undefined","focus","cur"],"mappings":"AAAA,YAAYA,WAAW,QAAQ;AAC/B,SAASC,eAAe,QAAQ,oBAAoB;AAEpD,SAASC,0BAA0B,QAAQ,cAAc;AAEzD,OAAO,SAASC,oBACdC,OAAgC;IAEhC,MAAM,EAAEC,aAAa,EAAEC,WAAW,EAAE,GAAGF;IACvC,MAAMG,kBAAkBP,MAAMQ,MAAM,CAAuB;IAC3D,MAAM,EAAEC,UAAU,EAAEC,YAAY,EAAE,GAAGT,gBAAiC;QAAEK;IAAY;IACpF,MAAMK,sBAAsB;YACnBF;QAAP,QAAOA,sBAAAA,WAAWG,OAAO,cAAlBH,0CAAAA,oBAAoBI,aAAa,CAAc,CAAC,CAAC,EAAEX,2BAA2B,CAAC,CAAC;IACzF;IAEA,MAAMY,sBAAsB,CAACC;QAC3B,MAAMC,SAASL;QACf,IAAIK,QAAQ;YACVA,OAAOC,eAAe,CAACf;QACzB;QAEA,IAAIa,YAAY;gBAEdR;YADAQ,WAAWG,YAAY,CAAChB,4BAA4B;aACpDK,2BAAAA,gBAAgBK,OAAO,cAAvBL,+CAAAA,yBAAyBW,YAAY,CAAC,yBAAyBH,WAAWI,EAAE;QAC9E,OAAO;gBACLZ;aAAAA,4BAAAA,gBAAgBK,OAAO,cAAvBL,gDAAAA,0BAAyBU,eAAe,CAAC;QAC3C;IACF;IAEAjB,MAAMoB,mBAAmB,CAACf,eAAe,IAAO,CAAA;YAC9CgB,OAAO;gBACL,IAAI,CAACZ,WAAWG,OAAO,IAAI,CAACL,gBAAgBK,OAAO,EAAE;oBACnD;gBACF;gBAEA,MAAMS,QAAQX,aAAaW,KAAK;gBAChC,IAAIA,OAAO;oBACTP,oBAAoBO;gBACtB;YACF;YACAC,MAAM;gBACJ,IAAI,CAACb,WAAWG,OAAO,IAAI,CAACL,gBAAgBK,OAAO,EAAE;oBACnD;gBACF;gBAEA,MAAMI,SAASL;gBACf,IAAI,CAACK,QAAQ;oBACX;gBACF;gBAEAN,aAAaa,UAAU,CAACP;gBACxB,MAAMM,OAAOZ,aAAaY,IAAI;gBAC9B,IAAIA,MAAM;oBACRR,oBAAoBQ;gBACtB;YACF;YACAE,MAAM;gBACJ,IAAI,CAACf,WAAWG,OAAO,IAAI,CAACL,gBAAgBK,OAAO,EAAE;oBACnD;gBACF;gBAEA,MAAMI,SAASL;gBACf,IAAI,CAACK,QAAQ;oBACX;gBACF;gBAEAN,aAAaa,UAAU,CAACP;gBACxB,MAAMM,OAAOZ,aAAac,IAAI;gBAE9B,IAAIF,QAAQA,SAASb,WAAWG,OAAO,EAAE;oBACvCE,oBAAoBQ;gBACtB;YACF;YACAG,MAAM;gBACJ,IAAI,CAAChB,WAAWG,OAAO,IAAI,CAACL,gBAAgBK,OAAO,EAAE;oBACnD;gBACF;gBAEAE,oBAAoBY;YACtB;YACAV,QAAQ;gBACN,IAAIP,WAAWG,OAAO,EAAE;wBACfD;oBAAP,QAAOA,uBAAAA,mCAAAA,2CAAAA,qBAAuBQ,EAAE;gBAClC;YACF;YAEAQ,OAAO,CAACR;gBACN,IAAI,CAACV,WAAWG,OAAO,EAAE;oBACvB;gBACF;gBAEAF,aAAaa,UAAU,CAACd,WAAWG,OAAO;gBAC1C,IAAIgB,MAAMlB,aAAaY,IAAI;gBAE3B,MAAOM,OAAOA,IAAIT,EAAE,KAAKA,GAAI;oBAC3BS,MAAMlB,aAAaY,IAAI;gBACzB;gBAEA,IAAIM,KAAK;oBACPd,oBAAoBc;gBACtB;YACF;QACF,CAAA;IAEA,OAAO;QAAEnB;QAAYF;IAAgB;AACvC"}